# 满汉助手 Android版本 - 完整使用指南

## 🎯 项目概述

本项目是将原版PC端的满汉助手完整移植到Android平台，**完全保留了原版的所有算法和逻辑**：

- ✅ **完整保留原版YOLO模型推理逻辑**
- ✅ **完整保留原版消除游戏算法**
- ✅ **完整保留原版交换评估函数**
- ✅ **完整保留原版特殊元素处理逻辑**
- ✅ **完整保留原版棋盘检测算法**
- ✅ **新增自适应手机分辨率支持**
- ✅ **新增Android触摸操作支持**

## 📁 项目结构

```
满汉助手Android版/
├── main.py                    # 主应用入口 (Kivy界面)
├── mobile_game_engine.py      # 完整游戏引擎 (保留所有原版算法)
├── buildozer.spec            # Android构建配置
├── requirements.txt          # Python依赖
├── model/
│   └── best.pt              # YOLO模型文件 (与原版相同)
├── .github/
│   └── workflows/
│       └── build-apk.yml    # GitHub Actions自动构建
├── setup-github.ps1         # GitHub设置脚本
├── build-simple.ps1         # 本地构建脚本
└── README.md                # 项目说明
```

## 🔧 核心功能保留

### 1. 完整的YOLO模型支持
- 支持原版best.pt模型文件
- 完全相同的类别映射 (香菇、蔬菜、鸡腿、蛋糕、红肉、鸡蛋、凤凰振翅、双龙戏珠)
- 相同的置信度处理逻辑
- 相同的邻居推断算法

### 2. 完整的消除算法
- 保留原版的交换生成逻辑
- 保留原版的有效性检查算法
- 保留原版的连线计数方法
- 保留原版的匹配查找算法

### 3. 完整的评估系统
- 保留原版的交换评估函数
- 保留原版的特殊元素处理逻辑
- 保留原版的L形/T形检测
- 保留原版的得分计算方法

### 4. 自适应分辨率支持
- 支持常见手机分辨率 (1080p, 2K, 720p等)
- 自动计算棋盘位置和格子大小
- 保持原版的坐标计算逻辑

## 🚀 快速开始

### 方法1: 使用GitHub Actions构建 (推荐)

1. **准备GitHub仓库**
   ```powershell
   # 运行GitHub设置脚本
   powershell -ExecutionPolicy Bypass -File setup-github.ps1
   ```

2. **创建GitHub仓库**
   - 访问 https://github.com/new
   - 仓库名: `mhcs-android`
   - 设为Public (免费使用GitHub Actions)
   - 不要初始化README等文件

3. **推送代码**
   ```bash
   git remote add origin https://github.com/YOUR_USERNAME/mhcs-android.git
   git branch -M main
   git push -u origin main
   ```

4. **自动构建**
   - 推送后GitHub Actions自动开始构建
   - 在仓库的"Actions"标签查看进度
   - 构建完成后在"Artifacts"下载APK

### 方法2: 本地构建 (需要环境配置)

1. **安装依赖**
   ```powershell
   # 运行本地构建脚本
   powershell -ExecutionPolicy Bypass -File build-simple.ps1
   ```

2. **手动构建**
   ```bash
   # 安装buildozer
   pip install buildozer cython

   # 构建APK
   buildozer android debug
   ```

## 📱 安装和使用

### 安装APK
1. 下载构建好的APK文件
2. 在Android设备上启用"未知来源"安装
3. 安装APK文件

### 首次使用
1. 启动应用
2. 点击"权限设置"按钮
3. 在系统设置中启用应用的无障碍服务
4. 返回应用，检查权限状态

### 基本操作
1. 打开目标游戏
2. 在满汉助手中点击"开始"
3. 应用将自动识别游戏界面并执行操作
4. 可随时点击"暂停"或"停止"

## 🎮 算法详解

### 1. 棋盘检测算法 (完全保留原版)
```python
def detect_board(self, img):
    # 1. 使用YOLO模型检测游戏元素
    # 2. 根据检测框中心点计算棋盘坐标
    # 3. 使用置信度选择最佳检测结果
    # 4. 对未检测到的格子进行邻居推断
```

### 2. 交换评估算法 (完全保留原版)
```python
def evaluate_swap(self, board, swap):
    # 1. 特殊元素交换高分奖励
    # 2. 普通消除基础分数计算
    # 3. L形/T形额外奖励
    # 4. 长消除奖励机制
```

### 3. 有效性检查算法 (完全保留原版)
```python
def is_valid_swap(self, board, swap):
    # 1. 双龙戏珠特殊规则
    # 2. 凤凰振翅特殊规则
    # 3. 普通3连消除规则
    # 4. 交叉消除检测
```

## 📊 分辨率适配

### 支持的分辨率
- **1080x1920** (1080p 竖屏) - 主流手机
- **1080x2340** (19.5:9 竖屏) - 全面屏手机
- **1080x2400** (20:9 竖屏) - 新款手机
- **720x1280** (720p 竖屏) - 入门手机
- **1440x2560** (2K 竖屏) - 高端手机
- **1440x2960** (2K+ 竖屏) - 三星等

### 自适应算法
```python
def calculate_adaptive_config(self, width, height):
    # 1. 检查预设配置
    # 2. 按比例缩放计算
    # 3. 边界检查和调整
    # 4. 确保棋盘完全显示
```

## 🔧 配置说明

### 游戏参数
- **目标步数**: 默认30步 (可在设置中修改)
- **目标分数**: 默认1000分 (可在设置中修改)
- **棋盘大小**: 8x8 (固定)

### 模型配置
- **模型文件**: model/best.pt
- **支持类别**: 8类 (6种普通食材 + 2种特殊元素)
- **置信度阈值**: 自动处理

## 🐛 常见问题

### Q: 应用无法识别游戏元素？
A: 检查以下项目：
- 模型文件model/best.pt是否存在
- 游戏界面是否完全可见
- 屏幕亮度是否适中
- 是否授予了屏幕录制权限

### Q: 触摸操作不生效？
A: 检查以下项目：
- 无障碍服务是否已启用
- 应用是否有系统级权限
- 设备是否支持input命令

### Q: 分辨率不匹配？
A: 应用会自动适配，如果有问题：
- 检查设备分辨率是否在支持列表中
- 查看日志中的自适应配置信息
- 可以手动添加新的分辨率配置

### Q: 构建失败？
A: 常见解决方案：
- 使用GitHub Actions云构建
- 检查网络连接
- 清理.buildozer目录重试
- 确保所有依赖正确安装

## 📈 性能优化

### 内存使用
- 应用占用约50-100MB内存
- YOLO模型约20-30MB
- 建议设备RAM ≥ 2GB

### 执行速度
- 每步操作约1-2秒
- 包含截图、推理、计算、执行
- 可通过调整执行间隔优化

### 电池消耗
- 中等功耗 (主要是屏幕截图和计算)
- 建议在充电时使用
- 可设置自动暂停功能

## 🔄 更新和维护

### 更新模型
1. 替换model/best.pt文件
2. 重新构建APK
3. 重新安装应用

### 添加新分辨率
1. 在RESOLUTION_CONFIGS中添加配置
2. 格式: (宽度, 高度): (棋盘X, 棋盘Y, 格子大小)
3. 重新构建APK

### 调整算法参数
1. 修改mobile_game_engine.py中的相关参数
2. 保持与原版算法的一致性
3. 重新构建和测试

## 📞 技术支持

### 日志查看
- 应用内置日志显示
- 可查看详细的执行过程
- 包含错误信息和调试信息

### 调试模式
- 可保存调试截图
- 显示棋盘检测结果
- 记录交换执行过程

---

**重要提示**: 本版本完全保留了原版算法的精髓，只是将运行平台从PC改为Android，确保了算法的一致性和有效性。
